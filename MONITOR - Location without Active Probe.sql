
INSERT INTO `Agents` (`Name`,`LocID`,`ClientID`,`ComputerID`,`DriveID`,`CheckAction`,`AlertAction`,`AlertMessage`,`ContactID`,`interval`,`Where`,`What`,`DataOut`,`Comparor`,`DataIn`,`LastScan`,`LastFailed`,`FailCount`,`IDField`,`AlertStyle`,`Changed`,`Last_Date`,`Last_User`,`ReportCategory`,`TicketCategory`,`Flags`,`GUID`,`AgentDefaultGUID`,`WarningCount`,`DeviceId`) Values('Location without Active Probe*','0','0','0','','0','1','%NAME% %STATUS% for location %CLIENTNAME%\\%locationname% (%locationid%)!!!%NAME% %STATUS% for location %FIELDNAME%.','1','43200','computers','ComputerID','computers.locationid NOT IN (SELECT DISTINCT computers.locationid FROM computers JOIN locations ON locations.locationid=computers.locationid AND locations.probeid=computers.computerid WHERE computers.lastcontact>DATE_ADD(NOW(),INTERVAL -14 DAY)) AND computers.locationid NOT IN (SELECT DISTINCT ID FROM extrafielddata WHERE extrafielddata.`\Value\`=1 AND extrafielddata.extrafieldid IN (SELECT ID FROM Extrafield WHERE \`Name\`= \'Exclude Offline Check\' AND Form = 2))','7','(SELECT MIN(ComputerID) FROM computers WHERE lastcontact>DATE_ADD(NOW(),INTERVAL -30 DAY) GROUP BY locationid)',NOW(),'1979/01/01 01:01:01','0','CONCAT(clients.name,\'\\\\\',locations.name,\' (\',locations.locationid,\') \',IF(probeid=0,\' - No Probe Assigned.\',CONCAT(\' - Probe (\',probeid,\') has stopped operating.\')))','0','0',NOW(),USER(),'9','0','0','115bad10-18ba-4f52-bebc-5654ef81475b','','0','0');
UPDATE locations JOIN computers ON computers.locationid=locations.locationid SET probeid=computerid WHERE flags&128=128 AND probeid=0 AND lastcontact>DATE_ADD(NOW(),INTERVAL -30 DAY);
